<?php
/*=========================================================================
MIDAS Server
Copyright (c) Kitware SAS. 20 rue de la Villette. All rights reserved.
69328 Lyon, FRANCE.

See Copyright.txt for details.
This software is distributed WITHOUT ANY WARRANTY; without even
the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE.  See the above copyright notices for more information.
=========================================================================*/


 
$this->headScript()->appendFile($this->coreWebroot . '/public/js/jquery/jquery.tablesorter.min.js');
$this->headScript()->appendFile($this->apiWebroot . '/public/js/common/common.ajaxapi.js');
$this->headScript()->appendFile($this->moduleWebroot . '/public/js/competitor/competitor.showscore.js');
?>
<link type="text/css" rel="stylesheet" href="<?php echo $this->coreWebroot?>/public/css/jquery/jquery.tablesorter.css" />
<link type="text/css" rel="stylesheet" href="<?php echo $this->moduleWebroot?>/public/css/competitor/competitor.showscore.css" />


<div id="showscores" class="viewMain" >
      <div class ="genericWrapperTopRight">
         <?php
          echo '<div style="float:right;margin-right:-200px;" class="genericBigButton ">';
            echo "<a  href='{$this->webroot}/user/userpage#ui-tabs-1'><img style='float:left;margin-right:2px;' alt='' src='{$this->coreWebroot}/public/images/icons/back.png'/>";
            echo $this->t('Back');  
            echo "</a>";
          echo '</div>';
          
        ?>
    </div>
<?php 
  echo '<h3>Results for ID '.$this->anonymizedId .' from '.$this->challengeName.', '.$this->resultsRun->getResultsType().' run on '. $this->resultsRun->getDate().'</h3>';
  echo '<img style="display: none" class="resultsLoading" alt="Loading..." src="'.$this->coreWebroot.'/public/images/icons/loading.gif" />';
?>
    <table class="tablesorter" id="tablesorter_scores">
      <thead>
        <tr class="header">
        <?php
        $tableHeaders = $this->tableHeaders;
        foreach($tableHeaders as $header)
          {
          echo "<th class='scorecol'>".ucfirst($header)."</th>";
          }
        ?>
        </tr>
        </thead>
        <tbody>
          <?php       
            $stripeClasses = array('odd', 'even');
            $stripeClassInd = 0;
            $resultsRows = $this->tableData['results_rows'];
            $rrisInError = $this->rrisInError;
            $rrisComplete = $this->rrisComplete;
            foreach($resultsRows as $subject => $scores)
              {
              echo "<tr class='resultsRow ".$stripeClasses[$stripeClassInd++ % 2]."'>";
              $resultsColumns = $this->tableData_resultsColumns;
              foreach($resultsColumns as $column)
                {
                if(!array_key_exists($column, $scores))
                  {
                  $colVal = MIDAS_CHALLENGE_RRI_STATUS_UNKNOWN;
                  echo "<td>".$colVal."</td>";
                  }
                elseif($scores[$column] == 'error')
                  {
                  $truthItemname = $scores['Subject'];
                  $rriid = $rrisInError[$truthItemname][$column];
                  echo '<td class="midasChallengeError" id="error_cell_rriid_'.$rriid.'">'.$scores[$column].'</td>';
                  } 
                else
                  {
                  $truthItemname = $scores['Subject'];
                  $colVal = $scores[$column];
                  $rriid = $rrisComplete[$truthItemname][$column];
                  if(empty($rriid))
                    {
                    echo "<td>".$colVal."</td>";
                    }
                  else
                    {
                    echo '<td class="midasChallengeJob" id="job_cell_rriid_'.$rriid.'">'.$colVal.'</td>';
                    }
                  }
                }
              echo "</tr>";
              }
          ?> 
      </tbody>
    </table>
    <br/>
    </div>



